{% extends 'dashboard/base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
    <div class="glass p-6 text-center">
        <a href="{% url 'alerts' %}"><button class="btn btn-cyan w-full">View Threat Alerts</button></a>
    </div>
    {% if user.is_authenticated %}
    <div class="glass p-6 text-center">
        <a href="{% url 'add_alert' %}"><button class="btn btn-green w-full">Report Incident</button></a>
    </div>
    <div class="glass p-6 text-center">
        <form method="post" action="{% url 'logout' %}" class="inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-red w-full">Logout</button>
        </form>
    </div>
    {% else %}
    <div class="glass p-6 text-center col-span-2">
        <a href="{% url 'register' %}"><button class="btn btn-green w-full">Create Account</button></a>
    </div>
    {% endif %}
</div>

{% if user.is_authenticated %}
<div class="glass p-8 mt-8 max-w-2xl mx-auto">
    <h3 class="text-xl font-bold text-cyan-300 mb-4 text-center">IP REPUTATION SCANNER</h3>
    <form method="post" class="space-y-4">
        {% csrf_token %}
        <div class="flex gap-4">
            <input name="ip" placeholder="Enter IP (e.g. 8.8.8.8)" required
                   class="flex-1 p-4 bg-gray-900 border border-cyan-500 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-400">
            <button type="submit" class="btn btn-orange">SCAN</button>
        </div>
    </form>

{% if result %}
<div class="glass p-6 mt-6 {% if result.is_malicious %}severity-critical{% else %}severity-low{% endif %}">
    <h4 class="text-xl font-bold text-cyan-300 mb-3">{{ result.ip }}</h4>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
        <div><strong>Abuse Score:</strong> <span class="text-orange-400">{{ result.score }}%</span></div>
        <div><strong>Country:</strong> {{ result.country }}</div>
        <div><strong>Reports:</strong> {{ result.reports }}</div>
        <div><strong>ISP:</strong> {{ result.isp }}</div>
        <div><strong>VT Malware:</strong> <span class="text-red-400">{{ result.vt_detections }}</span></div>
        <div><strong>Open Ports:</strong> {{ result.shodan_ports }}</div>
    </div>
    <p class="mt-4 font-bold text-lg {% if result.is_malicious %}text-red-400 animate-pulse{% else %}text-green-400{% endif %}">
        {{ result.is_malicious|yesno:"BLOCK & ISOLATE,Clean" }}
    </p>
</div>
{% elif result is not None %}
<div class="glass p-6 mt-6 border-l-6 border-red-500">
    <p class="text-red-400">Error: {{ result.error }}</p>
</div>
{% endif %}

</div>
{% endif %}
{% endblock %}
